<html>
    <head>
    </head>
    <body>
        <div style="float:left">
        <canvas id="board" width=500 height=500></canvas>
    </div>
        <div style="float:left">
            <button type="button" onclick="Scene.rotate()">Rotate</button>
    </div>

        <!--
        Vertex shader
        -->
        <script id="shader-vs" type="x-shader/x-vertex"> 
            precision highp float;
            attribute vec3 point;
            attribute vec3 rgb;
            attribute vec3 normal;
            attribute vec2 texCoord;

            uniform mat4 projectionMatrix;
            uniform mat4 modelViewMatrix;
            uniform mat3 normalMatrix;

            uniform vec3 lightPos;
            uniform vec4 lightSpecular;
            uniform vec4 lightAmbient;
            uniform vec4 lightDiffuse;

            uniform vec4 materialAmbient;
            uniform vec4 materialEmission;
            uniform vec4 materialSpecular;
            uniform vec4 materialDiffuse;
            uniform float materialShininess;

            vec4 phong()
            {
                //  P is the vertex coordinate on body
                vec3 P = vec3(modelViewMatrix * vec4(point,1.0));
                //  N is the object normal at P
                vec3 N = normalize(normalMatrix * normal);
                //  L is the light vector
                vec3 L = normalize(lightPos - P);

                //  Emission and ambient color
                vec4 color = vec4(rgb, 1.0) + materialEmission + materialAmbient*lightAmbient ;

                //  Diffuse light intensity is cosine of light and normal vectors
                float Id = dot(L,N);
                if (Id>0.0)
                    {
                        //  Add diffuse
                        color += Id*lightDiffuse*materialDiffuse;
                        //  R is the reflected light vector R = 2(L.N)N - L
                        vec3 R = reflect(-L, N);
                        //  V is the view vector (eye at the origin)
                        vec3 V = normalize(-P);
                        //  Specular is cosine of reflected and view vectors
                        float Is = dot(R,V);
                        if (Is>0.0) color += pow(Is,materialShininess)*lightSpecular*materialSpecular;
                    }

                    //  Return sum of color components
                    return color;
            }
            varying vec4 fColor;
            varying vec2 fTexCoord;

            void main(void)
            {
                fColor = phong();
                fTexCoord = texCoord;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(point,1.0);
            }
        </script> 

        <!--
        Fragment shader
        -->
        <script id="shader-fs" type="x-shader/x-fragment"> 
            precision highp float;
            varying vec4 fColor;

            varying vec2 fTexCoord;
            uniform sampler2D uSampler;

            void main(void)
            {
                gl_FragColor = fColor + texture2D(uSampler, fTexCoord);
            }
        </script> 

        <script src="lib/gl-matrix.js"></script>
        <script src="Scene.js"></script>
        <script src="Surface.js"></script>

        <script>
            (function() {
                Scene.init("board", 10);

                var shader = Scene.addShaderProg("shader-vs","shader-fs");

                var tex = Scene.initTexture("crate.bmp");

                var eqn = function (x,y) { 
                    return [ x, y , x*y ]
                }
                var surface = Surface.createSurface(eqn, eqn, -2,2,-2,2,10,10);
                surface.shaderProgIdx = shader;
                surface.textureIdx = tex;
                var obj = Scene.createObject(surface);
                Scene.addObject(obj);

                var wireFrame = Surface.createWireFrame(eqn,[0,0,0],-2,2,-2,2,10,10);
                wireFrame.shaderProgIdx = shader;
                wireFrame.drawMode = Scene.gl.LINES;

                var obj = Scene.createObject(wireFrame);
                mat4.translate(obj.transformationMatrix,obj.transformationMatrix, [0,0,0.01]);
                Scene.addObject(obj);
                // console.log(obj);

                Scene.display();
            })();

        </script>
    </body>
</html>
